<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Lume Â· Mood</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

:root {
  --m0: #FFB830; --m0r: 255,184,48;
  --m1: #FF6B35; --m1r: 255,107,53;
  --m2: #A78BFA; --m2r: 167,139,250;
  --m3: #4A9EFF; --m3r: 74,158,255;
  --m4: #9B6B9B; --m4r: 155,107,155;
  --mood: #A78BFA;
  --mood-r: 167,139,250;
  --bg: #06040F;
  --glass: rgba(255,255,255,0.05);
  --glass-b: rgba(255,255,255,0.10);
  --text: #F0EBF8;
  --muted: rgba(240,235,248,0.45);
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: var(--bg);
  font-family: 'DM Sans', sans-serif;
  color: var(--text);
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€ FULL-SCREEN APP WRAPPER â”€â”€ */
.app {
  position: fixed;
  inset: 0;
  overflow: hidden;
  background: var(--bg);
}
@media (min-width: 600px) {
  .app {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #020108;
    overflow: hidden;
  }
  .app::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 50% 40%, rgba(var(--mood-r),.06), transparent 60%);
    pointer-events: none;
    z-index: 0;
  }
}

/* â”€â”€ BG â”€â”€ */
.bg { position: absolute; inset: 0; background: var(--bg); overflow: hidden; z-index: 0; }
.orb { position: absolute; border-radius: 50%; filter: blur(90px); animation: drift linear infinite; transition: background 2s ease; }
.o1 { width: 320px; height: 320px; background: var(--mood); top: -100px; left: -80px; animation-duration: 20s; opacity: .5; }
.o2 { width: 260px; height: 260px; background: var(--m1); bottom: 80px; right: -80px; animation-duration: 25s; animation-delay: -8s; opacity: .25; }
.o3 { width: 200px; height: 200px; background: var(--m3); top: 45%; left: 25%; animation-duration: 17s; animation-delay: -4s; opacity: .2; }
.o4 { width: 220px; height: 220px; background: var(--m2); bottom: -60px; left: -40px; animation-duration: 22s; animation-delay: -12s; opacity: .3; }
@keyframes drift {
  0%   { transform: translate(0,0) scale(1); }
  25%  { transform: translate(35px,-45px) scale(1.1); }
  50%  { transform: translate(-25px,35px) scale(0.93); }
  75%  { transform: translate(45px,25px) scale(1.07); }
  100% { transform: translate(0,0) scale(1); }
}
.bg::after { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 50% 0%, rgba(var(--mood-r),.08), transparent 60%); transition: background 1.5s ease; pointer-events: none; }

/* particles */
.particles { position: absolute; inset: 0; overflow: hidden; pointer-events: none; z-index: 1; }
.pt { position: absolute; border-radius: 50%; background: rgba(255,255,255,.55); animation: rise linear infinite; }
@keyframes rise { from{transform:translateY(110vh) scale(0);opacity:0} 10%{opacity:1} 90%{opacity:.4} to{transform:translateY(-20px) scale(1);opacity:0} }

/* â”€â”€ STATUS BAR â”€â”€ */
.sb {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: calc(var(--safe-top) + 12px) 24px 10px;
  font-size: 12px;
  color: var(--muted);
  flex-shrink: 0;
  z-index: 5;
  position: relative;
  min-height: 50px;
  height: fit-content;
  width: 100%;
}
.sb .t { font-size: 15px; font-weight: 400; color: var(--text); }

/* â”€â”€ SCREENS â”€â”€ */
.screen {
  position: absolute;
  inset: 0;
  z-index: 10;
  display: flex;
  flex-direction: column;
  transition: opacity .45s cubic-bezier(.4,0,.2,1), transform .45s cubic-bezier(.4,0,.2,1);
}
.screen.hidden { opacity: 0; pointer-events: none; transform: translateY(20px); }

/* â”€â”€ GLASS â”€â”€ */
.gc { background: var(--glass); border: 1px solid var(--glass-b); border-radius: 20px; backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); }

/* â”€â”€ LABEL â”€â”€ */
.lbl { font-size: 10px; font-weight: 500; letter-spacing: .14em; text-transform: uppercase; color: var(--muted); }

/* â”€â”€ NAV â”€â”€ */
.nav {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  padding: 12px 20px calc(var(--safe-bottom) + 14px);
  display: flex;
  justify-content: space-around;
  background: linear-gradient(to top, rgba(6,4,15,.97) 60%, transparent);
  backdrop-filter: blur(12px);
  z-index: 20;
}
.ni { display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; transition: opacity .3s; }
.ni.active { opacity: 1; }
.ni:not(.active) { opacity: .35; }
.ni-icon { font-size: 19px; line-height: 1; }
.ni-label { font-size: 9px; letter-spacing: .07em; }
.ni-dot { width: 4px; height: 4px; border-radius: 50%; background: var(--mood); transition: background 1.5s; margin: 0 auto; }

/* â”€â”€ ANIMATIONS â”€â”€ */
@keyframes fsu { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:none} }
@keyframes breathe { 0%,100%{transform:scale(1)} 50%{transform:scale(1.055)} }
@keyframes pulse-ring { 0%{transform:scale(.85);opacity:.7} 100%{transform:scale(1.2);opacity:0} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#home .body { flex: 1; overflow-y: auto; overflow-x: hidden; scrollbar-width: none; padding: 0 18px calc(var(--safe-bottom) + 90px); }
#home .body::-webkit-scrollbar { display: none; }

.home-top { display: flex; justify-content: space-between; align-items: flex-start; padding: 12px 0 16px; animation: fsu .7s ease both; }
.greeting { font-family: 'Cormorant Garamond', serif; font-size: 12px; font-style: italic; color: var(--muted); letter-spacing: .08em; margin-bottom: 3px; }
.name-big { font-family: 'Cormorant Garamond', serif; font-size: 32px; font-weight: 300; line-height: 1; }
.avatar { width: 44px; height: 44px; border-radius: 50%; background: radial-gradient(circle at 40% 35%, rgba(255,255,255,.25), rgba(var(--mood-r),.4)); border: 1px solid rgba(var(--mood-r),.35); display: flex; align-items: center; justify-content: center; font-size: 18px; animation: breathe 5s ease-in-out infinite; transition: all 1.5s ease; }

/* today card */
.today-card { padding: 18px; margin-bottom: 12px; position: relative; overflow: hidden; animation: fsu .7s .1s ease both; }
.today-card::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at top left, rgba(var(--mood-r),.14), transparent 65%); border-radius: 20px; transition: background 1.5s ease; pointer-events: none; }

.mood-row { display: flex; align-items: center; gap: 12px; margin: 12px 0 14px; }
.bulb { width: 52px; height: 52px; border-radius: 50%; flex-shrink: 0; position: relative; transition: all 1.5s ease; animation: breathe 5s ease-in-out infinite; }
.bulb-inner { position: absolute; inset: 0; border-radius: 50%; }
.bulb-core { position: absolute; inset: 18%; border-radius: 50%; background: rgba(255,255,255,.95); filter: blur(4px); }
.bulb-glow { position: absolute; inset: -30%; border-radius: 50%; opacity: .5; filter: blur(20px); transition: background 1.5s; }

.mood-name-h { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 300; line-height: 1; margin-bottom: 3px; }
.mood-time-h { font-size: 11px; color: var(--muted); }
.mood-note-h { font-size: 13px; color: var(--muted); font-style: italic; line-height: 1.55; border-top: 1px solid var(--glass-b); padding-top: 12px; }

/* week */
.week-wrap { margin-bottom: 12px; animation: fsu .7s .2s ease both; }
.week-strip { display: flex; gap: 5px; margin-top: 10px; }
.wd { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; }
.wd-dot { width: 100%; aspect-ratio: 1; border-radius: 50%; transition: all .3s; position: relative; overflow: visible; max-width: 40px; }
.wd-dot.filled { animation: breathe 4s ease-in-out infinite; }
.wd-dot.filled::after { content: ''; position: absolute; inset: -40%; border-radius: 50%; opacity: .45; filter: blur(10px); background: inherit; z-index: -1; }
.wd-dot.empty { background: var(--glass); border: 1px solid var(--glass-b); }
.wd-lbl { font-size: 9px; color: var(--muted); letter-spacing: .05em; }

/* cta */
.cta-wrap { animation: fsu .7s .3s ease both; margin-bottom: 12px; }
.cta-btn { width: 100%; padding: 16px 18px; border-radius: 18px; background: rgba(var(--mood-r),.1); border: 1px solid rgba(var(--mood-r),.22); display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: all .3s; backdrop-filter: blur(20px); position: relative; overflow: hidden; }
.cta-btn:active { transform: scale(.98); }
.cta-btn::before { content: ''; position: absolute; inset: 0; background: linear-gradient(90deg,rgba(var(--mood-r),.07),transparent); transition: background 1.5s; }
.cta-lbl { font-size: 10px; letter-spacing: .1em; text-transform: uppercase; color: var(--muted); margin-bottom: 3px; }
.cta-text { font-family: 'Cormorant Garamond', serif; font-size: 20px; font-weight: 300; }
.flame { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; position: relative; transition: all 1.5s ease; }
.flame::before { content: ''; position: absolute; inset: -4px; border-radius: 50%; background: rgba(var(--mood-r),.2); filter: blur(8px); transition: background 1.5s; animation: breathe 3s ease-in-out infinite; }

/* stats */
.stats-card { padding: 18px 20px; animation: fsu .7s .4s ease both; }
.stats-row { display: flex; gap: 0; margin-top: 10px; }
.stat { flex: 1; text-align: center; }
.stat-val { font-family: 'Cormorant Garamond', serif; font-size: 28px; font-weight: 300; line-height: 1; }
.stat-lbl { font-size: 9px; color: var(--muted); letter-spacing: .08em; margin-top: 3px; }
.sdiv { width: 1px; background: var(--glass-b); margin: 4px 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECK-IN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#checkin { align-items: flex-start; padding: 0 18px calc(var(--safe-bottom) + 24px); display: flex; flex-direction: column; }
.ci-header { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 10px 0 6px; }
.back { width: 38px; height: 38px; border-radius: 50%; background: var(--glass); border: 1px solid var(--glass-b); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; transition: transform .2s; backdrop-filter: blur(20px); }
.back:active { transform: scale(.9); }
.ci-title { font-family: 'Cormorant Garamond', serif; font-size: 14px; font-style: italic; color: var(--muted); letter-spacing: .06em; }
.lume-logo { font-family: 'Cormorant Garamond', serif; font-size: 13px; font-style: italic; letter-spacing: .2em; color: var(--muted); }

.orb-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; position: relative; cursor: grab; user-select: none; min-height: 0; }
.orb-area:active { cursor: grabbing; }
.orb-hint { font-size: 10px; letter-spacing: .12em; text-transform: uppercase; color: var(--muted); margin-bottom: 20px; animation: fade-blink 3s ease-in-out infinite; }
@keyframes fade-blink { 0%,100%{opacity:.4} 50%{opacity:.9} }

.orb-wrap { position: relative; width: 200px; height: 200px; display: flex; align-items: center; justify-content: center; }
.ring { position: absolute; border-radius: 50%; border: 1px solid rgba(var(--mood-r),.18); animation: pulse-ring linear infinite; transition: border-color 1.5s; }
.r1{width:200px;height:200px;animation-duration:4s;animation-delay:0s}
.r2{width:240px;height:240px;animation-duration:4s;animation-delay:-1.33s}
.r3{width:280px;height:280px;animation-duration:4s;animation-delay:-2.66s}

.main-orb {
  width: 160px; height: 160px; border-radius: 50%; position: relative; z-index: 2;
  transition: box-shadow .5s ease, transform .1s ease;
  animation: breathe 6s ease-in-out infinite;
}
.main-orb.dragging { animation: none; }
.mo-shell { position: absolute; inset: 0; border-radius: 50%; transition: background .5s; }
.mo-core  { position: absolute; inset: 22%; border-radius: 50%; background: rgba(255,255,255,.92); filter: blur(6px); }
.mo-mid   { position: absolute; inset: 10%; border-radius: 50%; background: rgba(255,255,255,.15); filter: blur(2px); }
.mo-outer { position: absolute; inset: -25%; border-radius: 50%; opacity: .45; filter: blur(30px); transition: background .5s; }

.mood-display { margin-top: 22px; text-align: center; }
.mood-big { font-family: 'Cormorant Garamond', serif; font-size: 40px; font-weight: 300; line-height: 1; transition: color .5s; color: var(--mood); }
.mood-sub { font-size: 11px; color: var(--muted); margin-top: 4px; letter-spacing: .06em; }

.pips { display: flex; gap: 12px; margin-top: 18px; }
.pip { width: 13px; height: 13px; border-radius: 50%; cursor: pointer; transition: transform .3s, box-shadow .3s; border: 2px solid transparent; }
.pip.active { transform: scale(1.45); border-color: rgba(255,255,255,.35); box-shadow: 0 0 12px currentColor; }

.ci-bottom { width: 100%; }
.confirm-btn { width: 100%; padding: 16px; border-radius: 16px; background: rgba(var(--mood-r),.15); border: 1px solid rgba(var(--mood-r),.3); color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 500; letter-spacing: .05em; cursor: pointer; transition: all .3s; backdrop-filter: blur(20px); overflow: hidden; position: relative; }
.confirm-btn:active { transform: scale(.97); }

/* â”€â”€ CONFIRMATION â”€â”€ */
#confirmation { align-items: center; justify-content: center; text-align: center; padding: 40px 28px; }
.burst { width: 140px; height: 140px; border-radius: 50%; margin: 0 auto 30px; position: relative; animation: burst-in .8s cubic-bezier(.175,.885,.32,1.275) both; transition: box-shadow 1.5s; }
.burst-shell { position: absolute; inset: 0; border-radius: 50%; transition: background .5s; }
.burst-core { position: absolute; inset: 20%; border-radius: 50%; background: rgba(255,255,255,.9); filter: blur(8px); }
.burst-glow { position: absolute; inset: -30%; border-radius: 50%; opacity: .5; filter: blur(35px); transition: background .5s; animation: breathe 4s ease-in-out infinite; }
@keyframes burst-in { 0%{transform:scale(0);opacity:0} 70%{transform:scale(1.08)} 100%{transform:scale(1);opacity:1} }
.conf-msg { font-family: 'Cormorant Garamond', serif; font-size: 36px; font-weight: 300; line-height: 1.2; margin-bottom: 12px; animation: fsu .6s .3s ease both; }
.conf-sub { font-size: 14px; color: var(--muted); line-height: 1.7; animation: fsu .6s .5s ease both; }
.conf-sub strong { color: var(--mood); font-weight: 400; transition: color 1.5s; }
.home-btn { margin-top: 40px; padding: 14px 34px; border-radius: 50px; background: var(--glass); border: 1px solid var(--glass-b); color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; cursor: pointer; transition: all .3s; backdrop-filter: blur(20px); animation: fsu .6s .7s ease both; }
.home-btn:active { transform: scale(.95); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LUME (DIARY)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#lume .body { flex: 1; overflow-y: auto; scrollbar-width: none; padding: 0 18px calc(var(--safe-bottom) + 90px); }
#lume .body::-webkit-scrollbar { display: none; }

.lume-top { display: flex; justify-content: space-between; align-items: flex-end; padding: 10px 0 16px; animation: fsu .7s ease both; }
.lume-date { font-family: 'Cormorant Garamond', serif; font-size: 13px; font-style: italic; color: var(--muted); letter-spacing: .06em; }
.lume-title-main { font-family: 'Cormorant Garamond', serif; font-size: 30px; font-weight: 300; line-height: 1; }

.date-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; animation: fsu .7s .1s ease both; }
.date-arr { width: 34px; height: 34px; border-radius: 50%; background: var(--glass); border: 1px solid var(--glass-b); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; backdrop-filter: blur(20px); transition: transform .2s; }
.date-arr:active { transform: scale(.9); }
.date-label { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 300; }

.timeline { position: relative; padding-left: 28px; }
.tl-line { position: absolute; left: 9px; top: 12px; bottom: 12px; width: 1px; background: linear-gradient(to bottom, transparent, var(--glass-b) 10%, var(--glass-b) 90%, transparent); }

.tl-entry { position: relative; margin-bottom: 14px; animation: fsu .6s ease both; }
.tl-dot-wrap { position: absolute; left: -28px; top: 18px; }
.tl-dot { width: 18px; height: 18px; border-radius: 50%; border: 2px solid transparent; display: flex; align-items: center; justify-content: center; transition: all .3s; }
.tl-dot-inner { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,.9); }

.tl-card { padding: 16px 16px 14px; border-radius: 18px; position: relative; overflow: hidden; }
.tl-card::before { content: ''; position: absolute; inset: 0; border-radius: 18px; opacity: .12; transition: background 1.5s; }
.tl-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.tl-bulb { width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0; position: relative; }
.tl-bulb-core { position: absolute; inset: 25%; border-radius: 50%; background: rgba(255,255,255,.9); filter: blur(2px); }
.tl-bulb-glow { position: absolute; inset: -20%; border-radius: 50%; opacity: .4; filter: blur(10px); }
.tl-meta { flex: 1; }
.tl-time { font-size: 10px; color: var(--muted); letter-spacing: .07em; text-transform: uppercase; margin-bottom: 1px; }
.tl-mood-name { font-family: 'Cormorant Garamond', serif; font-size: 19px; font-weight: 300; line-height: 1; }
.tl-note { font-size: 13px; color: var(--muted); font-style: italic; line-height: 1.6; }
.tl-edit { display: flex; align-items: center; gap: 6px; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--glass-b); cursor: pointer; }
.tl-edit span { font-size: 10px; color: var(--muted); letter-spacing: .08em; text-transform: uppercase; }

.add-entry { width: 100%; padding: 14px 18px; border-radius: 16px; background: rgba(var(--mood-r),.08); border: 1px solid rgba(var(--mood-r),.18); display: flex; align-items: center; gap: 12px; cursor: pointer; transition: all .3s; backdrop-filter: blur(20px); margin-top: 4px; animation: fsu .7s .5s ease both; }
.add-entry:active { transform: scale(.98); }
.add-icon { width: 34px; height: 34px; border-radius: 50%; background: rgba(var(--mood-r),.2); display: flex; align-items: center; justify-content: center; font-size: 18px; transition: background 1.5s; }
.add-text { font-size: 13px; color: var(--muted); font-style: italic; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GALAXIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#galaxia .body { flex: 1; overflow-y: auto; scrollbar-width: none; padding: 0 18px calc(var(--safe-bottom) + 90px); }
#galaxia .body::-webkit-scrollbar { display: none; }

.gal-top { padding: 10px 0 14px; animation: fsu .7s ease both; }
.gal-title { font-family: 'Cormorant Garamond', serif; font-size: 30px; font-weight: 300; line-height: 1; margin-bottom: 3px; }
.gal-sub { font-size: 12px; color: var(--muted); font-style: italic; }

.month-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; animation: fsu .7s .1s ease both; }
.month-label { font-family: 'Cormorant Garamond', serif; font-size: 20px; font-weight: 300; }

.cal-wrap { animation: fsu .7s .2s ease both; padding: 16px; margin-bottom: 12px; }
.cal-days-header { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; margin-bottom: 8px; }
.cal-dh { text-align: center; font-size: 9px; letter-spacing: .1em; color: var(--muted); text-transform: uppercase; padding: 3px 0; }
.cal-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; }
.cal-cell { aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; position: relative; cursor: pointer; transition: transform .2s; }
.cal-cell:active { transform: scale(.9); }
.cal-cell.empty { opacity: 0; pointer-events: none; }
.cal-cell.no-mood { background: var(--glass); border: 1px solid var(--glass-b); color: var(--muted); }
.cal-cell.has-mood { color: rgba(15,10,30,.85); font-weight: 600; }
.cal-cell.today-cell { box-shadow: 0 0 0 2px rgba(255,255,255,.6); }
.cal-cell .cell-glow { position: absolute; inset: -30%; border-radius: 50%; opacity: .35; filter: blur(8px); pointer-events: none; }

/* mood legend */
.legend { display: flex; flex-wrap: wrap; gap: 6px; animation: fsu .7s .3s ease both; margin-bottom: 12px; }
.leg-item { display: flex; align-items: center; gap: 5px; padding: 5px 10px; border-radius: 20px; background: var(--glass); border: 1px solid var(--glass-b); backdrop-filter: blur(20px); }
.leg-dot { width: 7px; height: 7px; border-radius: 50%; }
.leg-name { font-size: 10px; color: var(--muted); }

/* month summary */
.month-summary { padding: 16px; animation: fsu .7s .4s ease both; }
.ms-title { font-family: 'Cormorant Garamond', serif; font-size: 17px; font-weight: 300; margin-bottom: 12px; }
.ms-bars { display: flex; flex-direction: column; gap: 10px; }
.ms-bar-row { display: flex; align-items: center; gap: 10px; }
.ms-bar-label { font-size: 11px; color: var(--muted); width: 65px; flex-shrink: 0; }
.ms-bar-track { flex: 1; height: 6px; background: var(--glass); border-radius: 3px; overflow: hidden; }
.ms-bar-fill { height: 100%; border-radius: 3px; transition: width 1s cubic-bezier(.4,0,.2,1); }
.ms-bar-count { font-size: 11px; color: var(--muted); width: 20px; text-align: right; flex-shrink: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PERFIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#perfil .body { flex: 1; overflow-y: auto; scrollbar-width: none; padding: 0 18px calc(var(--safe-bottom) + 90px); }
#perfil .body::-webkit-scrollbar { display: none; }

.perfil-header { display: flex; flex-direction: column; align-items: center; padding: 18px 0 16px; animation: fsu .7s ease both; }
.perfil-avatar { width: 82px; height: 82px; border-radius: 50%; position: relative; margin-bottom: 14px; }
.pa-shell { position: absolute; inset: 0; border-radius: 50%; transition: background .5s; }
.pa-core { position: absolute; inset: 25%; border-radius: 50%; background: rgba(255,255,255,.88); filter: blur(5px); }
.pa-outer { position: absolute; inset: -15%; border-radius: 50%; opacity: .35; filter: blur(20px); transition: background .5s; animation: breathe 5s ease-in-out infinite; }
.pa-ring { position: absolute; inset: -3px; border-radius: 50%; border: 1px solid rgba(var(--mood-r),.3); animation: pulse-ring 3s ease-in-out infinite; transition: border-color 1.5s; }
.perfil-name { font-family: 'Cormorant Garamond', serif; font-size: 28px; font-weight: 300; margin-bottom: 3px; }
.perfil-since { font-size: 11px; color: var(--muted); font-style: italic; }

/* mood identity */
.identity-card { padding: 18px; margin-bottom: 12px; animation: fsu .7s .1s ease both; }
.identity-title { font-family: 'Cormorant Garamond', serif; font-size: 15px; font-weight: 300; margin-bottom: 12px; color: var(--muted); font-style: italic; }
.identity-moods { display: flex; gap: 10px; }
.id-mood { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 7px; padding: 13px 6px; border-radius: 14px; background: rgba(255,255,255,.03); border: 1px solid var(--glass-b); }
.id-bulb { width: 42px; height: 42px; border-radius: 50%; position: relative; }
.id-bulb-core { position: absolute; inset: 22%; border-radius: 50%; background: rgba(255,255,255,.9); filter: blur(3px); }
.id-bulb-glow { position: absolute; inset: -20%; border-radius: 50%; opacity: .4; filter: blur(12px); }
.id-name { font-size: 10px; color: var(--muted); letter-spacing: .05em; text-align: center; }
.id-pct { font-family: 'Cormorant Garamond', serif; font-size: 17px; font-weight: 300; }

/* settings */
.settings-section { margin-bottom: 12px; animation: fsu .7s .2s ease both; }
.settings-title { font-size: 10px; letter-spacing: .14em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; padding: 0 2px; }
.setting-row { display: flex; align-items: center; justify-content: space-between; padding: 15px 16px; border-bottom: 1px solid var(--glass-b); }
.setting-row:last-child { border-bottom: none; }
.setting-left { display: flex; align-items: center; gap: 12px; }
.setting-icon { font-size: 16px; width: 22px; text-align: center; }
.setting-name { font-size: 14px; }
.setting-val { font-size: 13px; color: var(--muted); font-style: italic; }
.toggle { width: 44px; height: 24px; border-radius: 12px; position: relative; cursor: pointer; transition: background .3s; }
.toggle.on { background: rgba(var(--mood-r),.5); border: 1px solid rgba(var(--mood-r),.4); }
.toggle.off { background: var(--glass); border: 1px solid var(--glass-b); }
.toggle-knob { position: absolute; top: 2px; width: 20px; height: 20px; border-radius: 50%; background: var(--text); transition: left .3s; }
.toggle.on .toggle-knob { left: 22px; }
.toggle.off .toggle-knob { left: 2px; }

/* â”€â”€ LANGUAGE SELECTOR â”€â”€ */
.lang-selector { display: flex; gap: 6px; }
.lang-btn {
  padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; letter-spacing: .06em; cursor: pointer; transition: all .25s; border: 1px solid var(--glass-b); background: var(--glass);
  color: var(--muted);
}
.lang-btn.active {
  background: rgba(var(--mood-r),.2); border-color: rgba(var(--mood-r),.4); color: var(--text);
}

/* streak */
.streak-card { padding: 16px 18px; margin-bottom: 12px; display: flex; gap: 14px; animation: fsu .7s .3s ease both; }
.streak-num { font-family: 'Cormorant Garamond', serif; font-size: 48px; font-weight: 300; line-height: 1; color: var(--mood); transition: color 1.5s; }
.streak-right { display: flex; flex-direction: column; justify-content: center; gap: 2px; }
.streak-label { font-size: 13px; font-weight: 500; }
.streak-sub { font-size: 11px; color: var(--muted); font-style: italic; line-height: 1.5; }

/* â”€â”€ RIPPLE on calendar cell â”€â”€ */
@keyframes cal-ripple {
  0%   { transform: translate(-50%,-50%) scale(0); opacity: .85; }
  100% { transform: translate(-50%,-50%) scale(5); opacity: 0; }
}
.cal-ripple {
  position: absolute; width: 100%; height: 100%; border-radius: 50%;
  background: rgba(255,255,255,.55); animation: cal-ripple .6s ease-out forwards;
  pointer-events: none; top: 50%; left: 50%;
}

/* â”€â”€ MODE TRANSITION â”€â”€ */
body, .bg, .app, .nav, .orb, .ni, .lbl,
.mood-name-h, .mood-time-h, .mood-note-h, .name-big, .greeting,
.cta-btn, .confirm-btn, .date-arr, .tl-card, .tl-note,
.wd-lbl, .cal-dh, .leg-name, .ms-bar-label, .streak-sub,
.setting-name, .setting-val, .lume-title-main, .gal-title,
.perfil-name, .perfil-since, .stat-lbl, .streak-label {
  transition: background 0.7s ease, background-color 0.7s ease, color 0.6s ease, border-color 0.6s ease, box-shadow 0.8s ease, opacity 0.6s ease;
}
.gc { transition: background 0.7s ease, background-color 0.7s ease, border-color 0.6s ease, box-shadow 0.8s ease; }
.bg .orb { transition: background 0.9s ease, opacity 0.8s ease; }

/* â”€â”€ DAY MODE â”€â”€ */
body.day-mode {
  --bg: #F5F0FF; --glass: rgba(255,255,255,0.55); --glass-b: rgba(180,160,230,0.25);
  --text: #1A1030; --muted: rgba(26,16,48,0.45); background: #EDE8F8;
}
body.day-mode .bg { background: #F0EAFF; }
body.day-mode .o1 { opacity: .25; }
body.day-mode .o2 { opacity: .15; }
body.day-mode .o3 { opacity: .12; }
body.day-mode .o4 { opacity: .18; }
body.day-mode .nav { background: linear-gradient(to top, rgba(240,234,255,.97) 60%, transparent); }
body.day-mode .pt { background: rgba(var(--mood-r),.4); }

/* â”€â”€ HOME MODE BTN â”€â”€ */
.mode-btn {
  width: 44px; height: 44px; border-radius: 50%;
  background: var(--glass); border: 1px solid var(--glass-b);
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; cursor: pointer; backdrop-filter: blur(20px);
  transition: all .5s ease; animation: breathe 5s ease-in-out infinite;
}

/* â”€â”€ DAY DETAIL OVERLAY â”€â”€ */
#day-overlay { border-radius: 0; }

/* Custom cursor â€” hidden on touch devices */
* { cursor: none !important; }
#cursor {
  position: fixed; width: 44px; height: 44px; border-radius: 50%;
  border: 1.5px solid rgba(var(--mood-r), 0.7);
  box-shadow: 0 0 10px rgba(var(--mood-r), 0.3), inset 0 0 6px rgba(var(--mood-r), 0.08);
  pointer-events: none; z-index: 9999; transform: translate(-50%, -50%);
  transition: width .2s ease, height .2s ease, border-color .5s ease, box-shadow .5s ease, opacity .2s ease;
  backdrop-filter: blur(2px);
}
#cursor.pressed { width: 28px; height: 28px; border-color: rgba(var(--mood-r), 1); box-shadow: 0 0 20px rgba(var(--mood-r), 0.6), inset 0 0 10px rgba(var(--mood-r), 0.15); }
#cursor-dot {
  position: fixed; width: 4px; height: 4px; border-radius: 50%;
  background: rgba(var(--mood-r), 0.9); pointer-events: none; z-index: 9999;
  transform: translate(-50%, -50%); transition: background .5s ease;
}
@media (pointer: coarse) {
  * { cursor: auto !important; }
  #cursor, #cursor-dot { display: none; }
}

/* â”€â”€ On mobile, phone-frame is invisible / full-bleed â”€â”€ */
#phone-frame {
  position: absolute;
  inset: 0;
}
@media (min-width: 600px) {
  #phone-frame {
    position: relative;
    width: 390px;
    height: 844px;
    border-radius: 50px;
    overflow: hidden;
    box-shadow:
      0 0 0 1px rgba(255,255,255,0.07),
      0 50px 140px rgba(0,0,0,0.95),
      0 0 100px rgba(var(--mood-r),0.12);
    flex-shrink: 0;
    transition: box-shadow 1.5s ease;
  }
}

/* â”€â”€ CTA ANIMATED RING â”€â”€ */
.cta-flame-wrap {
  position: relative;
  width: 56px; height: 56px;
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
}
.cta-ring {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 1.5px solid rgba(var(--mood-r), 0.55);
  animation: cta-pulse 2.2s ease-out infinite;
  pointer-events: none;
}
.cta-ring:nth-child(2) {
  animation-delay: 0.7s;
  border-color: rgba(var(--mood-r), 0.3);
}
.cta-ring:nth-child(3) {
  animation-delay: 1.4s;
  border-color: rgba(var(--mood-r), 0.15);
}
@keyframes cta-pulse {
  0%   { transform: scale(1);   opacity: 1; }
  100% { transform: scale(2.1); opacity: 0; }
}
</style>
</head>
<body>

<div class="app" id="app">
<div id="cursor"></div>
<div id="cursor-dot"></div>
<div id="phone-frame">

  <!-- BG -->
  <div class="bg" id="bg">
    <div class="orb o1" id="o1"></div>
    <div class="orb o2"></div>
    <div class="orb o3"></div>
    <div class="orb o4"></div>
  </div>
  <div class="particles" id="particles"></div>

  <!-- â•â• HOME â•â• -->
  <div class="screen" id="home">
    <div class="sb"><span class="t sb-clock">--:--</span><span style="letter-spacing:.05em">â€¢â€¢â€¢</span><span>ğŸ”‹</span></div>
    <div class="body">
      <div class="home-top">
        <div>
          <div class="greeting" id="home-greeting">good evening,</div>
          <div class="name-big">SofÃ­a</div>
        </div>
        <div class="avatar" id="home-avatar" style="flex-direction:column;gap:1px;">
          <span style="font-size:16px;">â˜½</span>
          <span style="font-size:7px;letter-spacing:.05em;color:var(--muted);" id="home-avatar-label">night</span>
        </div>
        <div class="mode-btn" id="home-mode-btn" onclick="toggleNightModeFromHome()" title="Cambiar modo">ğŸŒ™</div>
      </div>

      <div class="gc today-card" id="home-today-card">
        <div class="lbl" id="lbl-tu-luz">Tu luz de hoy</div>
        <div class="mood-row">
          <div class="bulb" id="home-bulb">
            <div class="bulb-inner" id="home-bulb-inner"></div>
            <div class="bulb-core"></div>
            <div class="bulb-glow" id="home-bulb-glow"></div>
          </div>
          <div>
            <div class="mood-name-h" id="home-mood-name">Calma</div>
            <div class="mood-time-h" id="home-mood-time">Ãšltimo registro Â· 21:41</div>
          </div>
        </div>
        <div class="mood-note-h" id="home-mood-note">"Hoy me voy antes a la cama para aprovechar y leer."</div>
      </div>

      <div class="week-wrap">
        <div class="lbl" id="lbl-esta-semana">Esta semana</div>
        <div class="week-strip" id="week-strip"></div>
      </div>

      <div class="cta-wrap">
        <div class="cta-btn" onclick="showScreen('checkin')">
          <div>
            <div class="cta-lbl">Check-in</div>
            <div class="cta-text" id="home-cta-text">Â¿CÃ³mo brillas ahora?</div>
          </div>
          <div class="cta-flame-wrap">
            <div class="cta-ring"></div>
            <div class="cta-ring"></div>
            <div class="cta-ring"></div>
            <div class="flame" id="home-flame">âœ¦</div>
          </div>
        </div>
      </div>

      <div class="gc stats-card">
        <div class="lbl" id="lbl-constelacion">Tu constelaciÃ³n</div>
        <div class="stats-row">
          <div class="stat">
            <div class="stat-val" style="color:var(--mood);transition:color 1.5s">27</div>
            <div class="stat-lbl" id="stat-streak-lbl">dÃ­as seguidos</div>
          </div>
          <div class="sdiv"></div>
          <div class="stat">
            <div class="stat-val" id="stat-mood">Calma</div>
            <div class="stat-lbl" id="stat-freq-lbl">mÃ¡s frecuente</div>
          </div>
          <div class="sdiv"></div>
          <div class="stat">
            <div class="stat-val" id="stat-pct" style="color:var(--mood);transition:color 1.5s">33%</div>
            <div class="stat-lbl" id="stat-radiant-lbl">dÃ­as radiantes</div>
          </div>
        </div>
      </div>
    </div>
    <div class="nav" id="nav-home"></div>
  </div>

  <!-- â•â• CHECK-IN â•â• -->
  <div class="screen hidden" id="checkin">
    <div class="sb"><span class="t sb-clock">--:--</span><span style="letter-spacing:.05em">â€¢â€¢â€¢</span><span>ğŸ”‹</span></div>
    <div class="ci-header">
      <div class="back" onclick="showScreen('home')">â†</div>
      <div class="ci-title" id="ci-title-text">check-in Â· ahora</div>
      <div class="lume-logo">lume</div>
    </div>

    <div class="orb-area" id="orb-area">
      <div class="orb-hint" id="orb-hint">arrastra Â· toca Â· siente</div>
      <div class="orb-wrap">
        <div class="ring r1" id="r1"></div>
        <div class="ring r2" id="r2"></div>
        <div class="ring r3" id="r3"></div>
        <div class="main-orb" id="main-orb">
          <div class="mo-shell" id="mo-shell"></div>
          <div class="mo-mid"></div>
          <div class="mo-core"></div>
          <div class="mo-outer" id="mo-outer"></div>
        </div>
      </div>
      <div class="mood-display">
        <div class="mood-big" id="ci-mood-name">Calma</div>
        <div class="mood-sub" id="ci-mood-desc">Atardecer suave</div>
      </div>
      <div class="pips" id="pips"></div>
    </div>

    <div class="ci-bottom" style="padding:0 18px">
      <div class="gc note-block" style="margin-bottom:10px;padding:12px 16px;position:relative;">
        <div class="lbl" style="margin-bottom:7px;" id="lbl-note">AÃ±ade una nota</div>
        <textarea id="ci-note" placeholder="Â¿QuÃ© estÃ¡ pasando ahora mismoâ€¦?" style="width:100%;background:transparent;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;font-style:italic;line-height:1.6;resize:none;height:52px;" spellcheck="false"></textarea>
        <div id="note-count" style="position:absolute;bottom:8px;right:12px;font-size:10px;color:var(--muted);letter-spacing:.05em;">0 / 120</div>
      </div>
      <div class="confirm-btn" id="confirm-btn" onclick="showScreen('confirmation')">Guardar mi luz âœ¦</div>
    </div>
  </div>

  <!-- â•â• CONFIRMATION â•â• -->
  <div class="screen hidden" id="confirmation">
    <div class="sb"><span class="t sb-clock">--:--</span><span style="letter-spacing:.05em">â€¢â€¢â€¢</span><span>ğŸ”‹</span></div>
    <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 28px;text-align:center;">
      <div class="burst" id="burst">
        <div class="burst-shell" id="burst-shell"></div>
        <div class="burst-core"></div>
        <div class="burst-glow" id="burst-glow"></div>
      </div>
      <div class="conf-msg" id="conf-msg">Tu luz<br>ha sido<br>guardada.</div>
      <div class="conf-sub" id="conf-sub">Esta noche brillas con<br><strong id="conf-mood-word">Calma</strong> â€” sigue brillando.</div>
      <div class="home-btn" id="conf-home-btn" onclick="showScreen('home')">Volver al inicio</div>
    </div>
  </div>

  <!-- â•â• LUME DIARY â•â• -->
  <div class="screen hidden" id="lume">
    <div class="sb"><span class="t sb-clock">--:--</span><span style="letter-spacing:.05em">â€¢â€¢â€¢</span><span>ğŸ”‹</span></div>
    <div class="body">
      <div class="lume-top">
        <div>
          <div class="lume-date" id="lume-date">sÃ¡bado Â· 28 febrero</div>
          <div class="lume-title-main" id="lume-title">Mi diario</div>
        </div>
        <div class="lume-logo" style="padding-top:18px">lume</div>
      </div>

      <div class="date-nav">
        <div class="date-arr">â€¹</div>
        <div class="date-label" id="lbl-hoy">Hoy</div>
        <div class="date-arr" style="opacity:.3">â€º</div>
      </div>

      <div class="timeline" id="timeline">
        <div class="tl-line"></div>
      </div>

      <div class="add-entry" onclick="showScreen('checkin')">
        <div class="add-icon" id="add-icon">+</div>
        <div class="add-text" id="add-text">AÃ±adir nuevo registro de luzâ€¦</div>
      </div>
    </div>
    <div class="nav" id="nav-lume"></div>
  </div>

  <!-- â•â• GALAXIA â•â• -->
  <div class="screen hidden" id="galaxia">
    <div class="sb"><span class="t sb-clock">--:--</span><span style="letter-spacing:.05em">â€¢â€¢â€¢</span><span>ğŸ”‹</span></div>
    <div class="body">
      <div class="gal-top">
        <div class="gal-title" id="gal-title">Galaxia</div>
        <div class="gal-sub" id="gal-sub">el mapa de tu luz</div>
      </div>

      <div class="month-nav">
        <div class="date-arr">â€¹</div>
        <div class="month-label" id="month-label">Febrero 2026</div>
        <div class="date-arr" style="opacity:.3">â€º</div>
      </div>

      <div class="gc cal-wrap">
        <div class="cal-days-header" id="cal-header"></div>
        <div class="cal-grid" id="cal-grid"></div>
      </div>

      <div class="legend" id="cal-legend"></div>

      <div class="gc month-summary">
        <div class="ms-title" id="ms-title">DistribuciÃ³n del mes</div>
        <div class="ms-bars" id="ms-bars"></div>
      </div>
    </div>
    <div class="nav" id="nav-galaxia"></div>
  </div>

  <!-- â•â• PERFIL â•â• -->
  <div class="screen hidden" id="perfil">
    <div class="sb"><span class="t sb-clock">--:--</span><span style="letter-spacing:.05em">â€¢â€¢â€¢</span><span>ğŸ”‹</span></div>
    <div class="body">
      <div class="perfil-header">
        <div class="perfil-avatar">
          <div class="pa-shell" id="pa-shell"></div>
          <div class="pa-core"></div>
          <div class="pa-outer" id="pa-outer"></div>
          <div class="pa-ring" id="pa-ring"></div>
        </div>
        <div class="perfil-name">SofÃ­a</div>
        <div class="perfil-since" id="perfil-since">brillando desde enero 2026</div>
      </div>

      <div class="gc streak-card">
        <div class="streak-num" id="streak-num">27</div>
        <div class="streak-right">
          <div class="streak-label" id="streak-label">dÃ­as de racha</div>
          <div class="streak-sub" id="streak-sub">Tu luz nunca se ha<br>apagado esta semana âœ¦</div>
        </div>
      </div>

      <div class="gc identity-card">
        <div class="identity-title" id="identity-title">Tus luces mÃ¡s frecuentes</div>
        <div class="identity-moods" id="identity-moods"></div>
      </div>

      <div class="settings-section">
        <div class="settings-title" id="settings-pref-title">Preferencias</div>
        <div class="gc" style="overflow:hidden">
          <div class="setting-row">
            <div class="setting-left"><span class="setting-icon">ğŸ””</span><span class="setting-name" id="s-reminder">Recordatorio diario</span></div>
            <div style="display:flex;align-items:center;gap:10px"><span class="setting-val">21:00</span><div class="toggle on" onclick="this.classList.toggle('on');this.classList.toggle('off')"><div class="toggle-knob"></div></div></div>
          </div>
          <div class="setting-row">
            <div class="setting-left"><span class="setting-icon" id="night-icon">ğŸŒ™</span><span class="setting-name" id="night-mode-label">Modo noche</span></div>
            <div class="toggle on" id="night-toggle" onclick="toggleNightMode(this)"><div class="toggle-knob"></div></div>
          </div>
          <div class="setting-row">
            <div class="setting-left"><span class="setting-icon">âœ¦</span><span class="setting-name" id="s-anim">Animaciones</span></div>
            <div class="toggle on" onclick="this.classList.toggle('on');this.classList.toggle('off')"><div class="toggle-knob"></div></div>
          </div>
          <div class="setting-row">
            <div class="setting-left"><span class="setting-icon">ğŸŒ</span><span class="setting-name" id="s-lang-label">Idioma / Language</span></div>
            <div class="lang-selector">
              <div class="lang-btn" id="lang-es" onclick="setLanguage('es')">ES</div>
              <div class="lang-btn active" id="lang-en" onclick="setLanguage('en')">EN</div>
            </div>
          </div>
          <div class="setting-row">
            <div class="setting-left"><span class="setting-icon">ğŸ”’</span><span class="setting-name" id="s-privacy">Privacidad</span></div>
            <div class="setting-val" id="s-privacy-val">Solo tÃº</div>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-title" id="settings-account-title">Cuenta</div>
        <div class="gc" style="overflow:hidden">
          <div class="setting-row">
            <div class="setting-left"><span class="setting-icon">âœ‰ï¸</span><span class="setting-name">sofia@lumemood.com</span></div>
          </div>
          <div class="setting-row" style="cursor:pointer">
            <div class="setting-left"><span class="setting-icon" style="color:#ff6b6b">â†©</span><span class="setting-name" style="color:#ff6b6b;opacity:.7" id="s-logout">Cerrar sesiÃ³n</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="nav" id="nav-perfil"></div>
  </div>

  <!-- â•â• DAY DETAIL OVERLAY â•â• -->
  <div id="day-overlay" style="position:absolute;inset:0;z-index:50;display:flex;flex-direction:column;opacity:0;pointer-events:none;transition:opacity .4s ease;">
    <div id="day-overlay-bg" style="position:absolute;inset:0;backdrop-filter:blur(22px);"></div>
    <div id="day-overlay-grad" style="position:absolute;inset:0;pointer-events:none;"></div>
    <div id="day-overlay-inner" style="position:relative;z-index:1;display:flex;flex-direction:column;height:100%;">
      <div class="sb"><span class="t sb-clock">--:--</span><span style="letter-spacing:.05em">â€¢â€¢â€¢</span><span>ğŸ”‹</span></div>
      <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 20px 8px;">
        <div>
          <div style="font-size:10px;letter-spacing:.12em;text-transform:uppercase;margin-bottom:3px;opacity:.5;" id="overlay-day-name">MiÃ©rcoles</div>
          <div style="font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:300;" id="overlay-date">11 de febrero</div>
        </div>
        <div id="day-overlay-close" style="width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;backdrop-filter:blur(20px);border:1px solid rgba(128,100,200,.25);background:rgba(128,100,200,.1);">âœ•</div>
      </div>
      <div id="day-dominant" style="margin:0 20px 14px;padding:11px 14px;border-radius:14px;display:flex;align-items:center;gap:12px;">
        <div id="day-dom-bulb" style="width:34px;height:34px;border-radius:50%;flex-shrink:0;position:relative;">
          <div id="day-dom-shell" style="position:absolute;inset:0;border-radius:50%;"></div>
          <div style="position:absolute;inset:25%;border-radius:50%;background:rgba(255,255,255,.88);filter:blur(2px);"></div>
          <div id="day-dom-glow" style="position:absolute;inset:-20%;border-radius:50%;opacity:.4;filter:blur(10px);"></div>
        </div>
        <div>
          <div style="font-size:10px;letter-spacing:.1em;text-transform:uppercase;margin-bottom:1px;opacity:.5;" id="overlay-dominant-lbl">Luz dominante del dÃ­a</div>
          <div id="day-dom-name" style="font-family:'Cormorant Garamond',serif;font-size:19px;font-weight:300;"></div>
        </div>
      </div>
      <div id="day-entries" style="flex:1;overflow-y:auto;scrollbar-width:none;padding:0 20px 40px;"></div>
    </div>
  </div>
  <!-- â•â• EDIT ENTRY MODAL â•â• -->
  <div id="edit-modal" style="position:absolute;inset:0;z-index:60;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;opacity:0;pointer-events:none;transition:opacity .35s ease;">
    <div id="edit-modal-backdrop" style="position:absolute;inset:0;background:rgba(6,4,15,.7);backdrop-filter:blur(8px);" onclick="closeEditModal()"></div>
    <div style="position:relative;z-index:1;width:100%;background:linear-gradient(to bottom,rgba(18,12,36,.98),rgba(10,6,20,.99));border-top-left-radius:28px;border-top-right-radius:28px;padding:20px 20px calc(var(--safe-bottom)+28px);border-top:1px solid rgba(255,255,255,.1);">
      <div style="width:40px;height:4px;border-radius:2px;background:rgba(255,255,255,.18);margin:0 auto 20px;"></div>
      <div style="font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:300;color:#F0EBF8;margin-bottom:6px;" id="edit-modal-slot">Editing entry</div>
      <div style="font-size:11px;color:rgba(240,235,248,.4);letter-spacing:.06em;margin-bottom:20px;" id="edit-modal-time"></div>

      <!-- Mood picker -->
      <div style="font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:rgba(240,235,248,.4);margin-bottom:10px;" id="edit-lbl-mood">Mood</div>
      <div style="display:flex;gap:8px;margin-bottom:18px;" id="edit-mood-pips"></div>

      <!-- Note -->
      <div style="font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:rgba(240,235,248,.4);margin-bottom:8px;" id="edit-lbl-note">Note</div>
      <div style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:12px 14px;margin-bottom:20px;position:relative;">
        <textarea id="edit-note" style="width:100%;background:transparent;border:none;outline:none;color:#F0EBF8;font-family:'DM Sans',sans-serif;font-size:13px;font-style:italic;line-height:1.6;resize:none;height:60px;" spellcheck="false"></textarea>
      </div>

      <!-- Save button -->
      <div id="edit-save-btn" onclick="saveEditModal()" style="width:100%;padding:15px;border-radius:14px;background:rgba(var(--mood-r),.18);border:1px solid rgba(var(--mood-r),.3);color:#F0EBF8;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:500;letter-spacing:.05em;text-align:center;cursor:pointer;transition:all .2s;" id="edit-save-btn">Save changes âœ¦</div>
    </div>
  </div>

</div><!-- /phone-frame -->
</div><!-- /app -->

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRANSLATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const T = {
  es: {
    moods: [
      { name:'Radiante',  desc:'Vibe: AlegrÃ­a expansiva, Ã©xito, plenitud' },
      { name:'EnergÃ­a',   desc:'Vibe: MotivaciÃ³n, movimiento, creatividad activa' },
      { name:'Calma',     desc:'Vibe: Serenidad, descanso, respiraciÃ³n pausada' },
      { name:'ReflexiÃ³n', desc:'Vibe: IntrospecciÃ³n, aprendizaje, observaciÃ³n' },
      { name:'Sombra',    desc:'Vibe: Tristeza, cansancio, vulnerabilidad' },
    ],
    nav: ['Inicio','Lume','Galaxia','Perfil'],
    week_days: ['L','M','X','J','V','S','D'],
    cal_days: ['D','L','M','X','J','V','S'],
    diary: [
      { time:'08:15', slot:'MaÃ±ana',  note:'ReuniÃ³n temprana. Me sentÃ­ activa y con energÃ­a, aunque nerviosa.', moodIdx: 0 },
      { time:'14:30', slot:'Tarde',   note:'El dÃ­a fue tranquilo. Una taza de tÃ© y mÃºsica suave.', moodIdx: 3 },
      { time:'21:41', slot:'Noche',   note:'Hoy me voy antes a la cama para aprovechar y leer.', moodIdx: 2 },
    ],
    day_detail: [
      { time:'07:50', slot:'MaÃ±ana',   note:'EmpecÃ© el dÃ­a disparada. Lista para conquistar todo lo que tenÃ­a pendiente.' },
      { time:'12:30', slot:'MediodÃ­a', note:'Sin parar desde las 8h. ReuniÃ³n, sprint, otra reuniÃ³n. Adrenalina a tope.' },
      { time:'17:45', slot:'Tarde',    note:'El cuerpo empieza a acusar el ritmo. Mucho trabajo acumulado, la cabeza no para.' },
      { time:'22:00', slot:'Noche',    note:'Por fin parÃ©. Un baÃ±o caliente y a descansar. MaÃ±ana con mÃ¡s calma.' },
    ],
    home_greeting_morning: 'buenos dÃ­as,',
    home_greeting_afternoon: 'buenas tardes,',
    home_greeting_night: 'buenas noches,',
    home_greeting_day:   'buenas tardes,',
    home_avatar_morning: 'maÃ±ana',
    home_avatar_night: 'noche',
    home_avatar_day: 'tarde',
    lbl_tu_luz: 'Tu luz de hoy',
    home_mood_time: 'Ãšltimo registro Â· 21:41',
    home_mood_note: '"Hoy me voy antes a la cama para aprovechar y leer."',
    lbl_esta_semana: 'Esta semana',
    home_cta_text: 'Â¿CÃ³mo brillas ahora?',
    lbl_constelacion: 'Tu constelaciÃ³n',
    stat_streak: 'dÃ­as seguidos',
    stat_freq: 'mÃ¡s frecuente',
    stat_radiant: 'dÃ­as radiantes',
    ci_title: 'check-in Â· ahora',
    orb_hint: 'arrastra Â· toca Â· siente',
    lbl_note: 'AÃ±ade una nota',
    note_placeholder: 'Â¿QuÃ© estÃ¡ pasando ahora mismoâ€¦?',
    confirm_btn: 'Guardar mi luz âœ¦',
    conf_msg: 'Tu luz<br>ha sido<br>guardada.',
    conf_sub_prefix: 'Esta noche brillas con',
    conf_sub_suffix: 'â€” sigue brillando.',
    conf_home_btn: 'Volver al inicio',
    lume_date: 'sÃ¡bado Â· 28 febrero',
    lume_title: 'Mi diario',
    lbl_hoy: 'Hoy',
    add_text: 'AÃ±adir nuevo registro de luzâ€¦',
    gal_title: 'Galaxia',
    gal_sub: 'el mapa de tu luz',
    month_label: 'Febrero 2026',
    ms_title: 'DistribuciÃ³n del mes',
    identity_title: 'Tus luces mÃ¡s frecuentes',
    streak_label: 'dÃ­as de racha',
    streak_sub: 'Tu luz lleva 27 dÃ­as<br>sin apagarse âœ¦',
    perfil_since: 'brillando desde enero 2026',
    settings_pref: 'Preferencias',
    settings_account: 'Cuenta',
    s_reminder: 'Recordatorio diario',
    s_night_on: 'Modo noche',
    s_night_off: 'Modo dÃ­a',
    s_anim: 'Animaciones',
    s_lang: 'Idioma / Language',
    s_privacy: 'Privacidad',
    s_privacy_val: 'Solo tÃº',
    s_logout: 'Cerrar sesiÃ³n',
    overlay_dominant: 'Luz dominante del dÃ­a',
    tl_edit: 'Editar',
  },
  en: {
    moods: [
      { name:'Radiant',    desc:'Vibe: Expansive joy, success, wholeness' },
      { name:'Energy',     desc:'Vibe: Motivation, movement, active creativity' },
      { name:'Calm',       desc:'Vibe: Serenity, rest, slow breathing' },
      { name:'Reflection', desc:'Vibe: Introspection, learning, observation' },
      { name:'Shadow',     desc:'Vibe: Sadness, tiredness, vulnerability' },
    ],
    nav: ['Home','Lume','Galaxy','Profile'],
    week_days: ['M','T','W','T','F','S','S'],
    cal_days: ['S','M','T','W','T','F','S'],
    diary: [
      { time:'08:15', slot:'Morning',   note:'Early meeting. Felt active and energized, though a little nervous.', moodIdx: 0 },
      { time:'14:30', slot:'Afternoon', note:'The day was quiet. A cup of tea and soft music.', moodIdx: 3 },
      { time:'21:41', slot:'Evening',   note:'Going to bed early tonight to read.', moodIdx: 2 },
    ],
    day_detail: [
      { time:'07:50', slot:'Morning',   note:'Started the day fired up. Ready to tackle everything on my list.' },
      { time:'12:30', slot:'Midday',    note:'Non-stop since 8am. Meeting, sprint, another meeting. Adrenaline peaking.' },
      { time:'17:45', slot:'Afternoon', note:'The body is starting to feel the pace. Too much on my mind.' },
      { time:'22:00', slot:'Evening',   note:'Finally stopped. A warm bath and off to rest. Tomorrow, more calmly.' },
    ],
    home_greeting_morning: 'good morning,',
    home_greeting_afternoon: 'good afternoon,',
    home_greeting_night: 'good evening,',
    home_greeting_day:   'good afternoon,',
    home_avatar_morning: 'morning',
    home_avatar_night: 'night',
    home_avatar_day: 'day',
    lbl_tu_luz: 'Your light today',
    home_mood_time: 'Last record Â· 21:41',
    home_mood_note: '"Going to bed early tonight to read."',
    lbl_esta_semana: 'This week',
    home_cta_text: 'How are you shining now?',
    lbl_constelacion: 'Your constellation',
    stat_streak: 'days in a row',
    stat_freq: 'most frequent',
    stat_radiant: 'radiant days',
    ci_title: 'check-in Â· now',
    orb_hint: 'drag Â· tap Â· feel',
    lbl_note: 'Add a note',
    note_placeholder: 'What\'s happening right nowâ€¦?',
    confirm_btn: 'Save my light âœ¦',
    conf_msg: 'Your light<br>has been<br>saved.',
    conf_sub_prefix: 'Tonight you shine with',
    conf_sub_suffix: 'â€” keep shining.',
    conf_home_btn: 'Back to home',
    lume_date: 'saturday Â· 28 february',
    lume_title: 'My diary',
    lbl_hoy: 'Today',
    add_text: 'Add new light entryâ€¦',
    gal_title: 'Galaxy',
    gal_sub: 'the map of your light',
    month_label: 'February 2026',
    ms_title: 'Month distribution',
    identity_title: 'Your most frequent lights',
    streak_label: 'day streak',
    streak_sub: 'Your light has been shining<br>for 27 days straight âœ¦',
    perfil_since: 'shining since January 2026',
    settings_pref: 'Preferences',
    settings_account: 'Account',
    s_reminder: 'Daily reminder',
    s_night_on: 'Dark Mode',
    s_night_off: 'Light Mode',
    s_anim: 'Animations',
    s_lang: 'Idioma / Language',
    s_privacy: 'Privacy',
    s_privacy_val: 'Only you',
    s_logout: 'Sign out',
    overlay_dominant: 'Dominant light of the day',
    tl_edit: 'Edit',
  }
};

let currentLang = 'en';
let currentMoodIdx = 2;
let activeScreen = 'home';
let isNightMode = true;

// â”€â”€ MOODS (dynamic from translations) â”€â”€
function getMoods() { return T[currentLang].moods; }
const MOOD_COLORS = ['#FFB830','#FF6B35','#A78BFA','#4A9EFF','#9B6B9B'];
const MOOD_RGB    = ['255,184,48','255,107,53','167,139,250','74,158,255','155,107,155'];

const WEEK = [
  {d:0,m:0},{d:1,m:2},{d:2,m:1},{d:3,m:2},{d:4,m:3},{d:5,m:2},{d:6,m:-1}
];

const CAL_DATA = [2,1,0,2,3,2,4, 0,2,4,1,0,2,3, 2,4,0,2,1,4,0, 3,3,2,1,0,2,-1];
const STATS_DIST = [
  { moodIdx:0, count:6 },{ moodIdx:1, count:4 },{ moodIdx:2, count:9 },
  { moodIdx:3, count:4 },{ moodIdx:4, count:4 },
];

const NAV_IDS = ['home','lume','galaxia','perfil'];
const NAV_ICONS = ['â—ˆ','âœ¦','â—Œ','â—'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUAGE SWITCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLanguage(lang) {
  currentLang = lang;
  document.getElementById('lang-es').classList.toggle('active', lang === 'es');
  document.getElementById('lang-en').classList.toggle('active', lang === 'en');
  document.documentElement.lang = lang;

  const t = T[lang];
  // Static UI labels
  document.getElementById('lbl-tu-luz').textContent = t.lbl_tu_luz;
  document.getElementById('home-mood-time').textContent = t.home_mood_time;
  document.getElementById('home-mood-note').textContent = t.home_mood_note;
  document.getElementById('lbl-esta-semana').textContent = t.lbl_esta_semana;
  document.getElementById('home-cta-text').textContent = t.home_cta_text;
  document.getElementById('lbl-constelacion').textContent = t.lbl_constelacion;
  document.getElementById('stat-streak-lbl').textContent = t.stat_streak;
  document.getElementById('stat-freq-lbl').textContent = t.stat_freq;
  document.getElementById('stat-radiant-lbl').textContent = t.stat_radiant;
  document.getElementById('ci-title-text').textContent = t.ci_title;
  document.getElementById('orb-hint').textContent = t.orb_hint;
  document.getElementById('lbl-note').textContent = t.lbl_note;
  document.getElementById('ci-note').placeholder = t.note_placeholder;
  document.getElementById('confirm-btn').textContent = t.confirm_btn;
  document.getElementById('conf-msg').innerHTML = t.conf_msg;
  document.getElementById('conf-home-btn').textContent = t.conf_home_btn;
  document.getElementById('lume-date').textContent = t.lume_date;
  document.getElementById('lume-title').textContent = t.lume_title;
  document.getElementById('lbl-hoy').textContent = t.lbl_hoy;
  document.getElementById('add-text').textContent = t.add_text;
  document.getElementById('gal-title').textContent = t.gal_title;
  document.getElementById('gal-sub').textContent = t.gal_sub;
  document.getElementById('month-label').textContent = t.month_label;
  document.getElementById('ms-title').textContent = t.ms_title;
  document.getElementById('identity-title').textContent = t.identity_title;
  document.getElementById('streak-label').textContent = t.streak_label;
  document.getElementById('streak-sub').innerHTML = t.streak_sub;
  document.getElementById('perfil-since').textContent = t.perfil_since;
  document.getElementById('settings-pref-title').textContent = t.settings_pref;
  document.getElementById('settings-account-title').textContent = t.settings_account;
  document.getElementById('s-reminder').textContent = t.s_reminder;
  document.getElementById('night-mode-label').textContent = isNightMode ? t.s_night_on : t.s_night_off;
  document.getElementById('s-anim').textContent = t.s_anim;
  document.getElementById('s-lang-label').textContent = t.s_lang;
  document.getElementById('s-privacy').textContent = t.s_privacy;
  document.getElementById('s-privacy-val').textContent = t.s_privacy_val;
  document.getElementById('s-logout').textContent = t.s_logout;
  document.getElementById('overlay-dominant-lbl').textContent = t.overlay_dominant;

  // Greeting
  document.getElementById('home-greeting').textContent = getTimeGreeting(t);
  document.getElementById('home-avatar-label').textContent = getTimeAvatarLabel(t);

  // Mood name in home + stat
  const moods = getMoods();
  document.getElementById('home-mood-name').textContent = moods[currentMoodIdx].name;
  document.getElementById('home-mood-name').style.color = MOOD_COLORS[currentMoodIdx];
  document.getElementById('stat-mood').textContent = moods[2].name; // Calm/Calma most frequent
  document.getElementById('ci-mood-name').textContent = moods[currentMoodIdx].name;
  document.getElementById('ci-mood-desc').textContent = moods[currentMoodIdx].desc;
  document.getElementById('conf-mood-word').textContent = moods[currentMoodIdx].name;

  // Rebuild dynamic sections
  rebuildWeek();
  rebuildDiary();
  rebuildCalendar();
  rebuildIdentity();
  rebuildNavs();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyTheme(idx) {
  const r = document.documentElement;
  r.style.setProperty('--mood', MOOD_COLORS[idx]);
  r.style.setProperty('--mood-r', MOOD_RGB[idx]);
  document.getElementById('o1').style.background = MOOD_COLORS[idx];
}

function setBulb(shell, glow, idx) {
  if(shell) shell.style.background = `radial-gradient(circle at 38% 32%, rgba(255,255,255,.55), ${MOOD_COLORS[idx]} 55%, rgba(0,0,0,.25))`;
  if(glow)  glow.style.background  = MOOD_COLORS[idx];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rebuildNavs() {
  const labels = T[currentLang].nav;
  NAV_IDS.forEach(screenId => {
    const el = document.getElementById('nav-' + screenId);
    el.innerHTML = '';
    NAV_IDS.forEach((id, i) => {
      const ni = document.createElement('div');
      ni.className = 'ni' + (id === screenId ? ' active' : '');
      ni.innerHTML = `<div class="ni-icon">${NAV_ICONS[i]}</div><div class="ni-label">${labels[i]}</div>${id===screenId?'<div class="ni-dot"></div>':''}`;
      ni.onclick = () => showScreen(id);
      el.appendChild(ni);
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  activeScreen = id;

  if(id === 'confirmation') {
    const t = T[currentLang];
    const moods = getMoods();
    const m = moods[currentMoodIdx];
    setBulb(document.getElementById('burst-shell'), document.getElementById('burst-glow'), currentMoodIdx);
    document.getElementById('conf-mood-word').textContent = m.name;
    document.getElementById('conf-mood-word').style.color = MOOD_COLORS[currentMoodIdx];
    document.getElementById('conf-sub').innerHTML = `${t.conf_sub_prefix}<br><strong id="conf-mood-word" style="color:${MOOD_COLORS[currentMoodIdx]}">${m.name}</strong> ${t.conf_sub_suffix}`;
    applyTheme(currentMoodIdx);

    // Save new entry to diary with real time
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,'0');
    const mm2 = String(now.getMinutes()).padStart(2,'0');
    const realTime = hh + ':' + mm2;
    const noteVal = (document.getElementById('ci-note').value || '').trim();
    const hour = now.getHours();
    const slotEs = hour < 6 ? 'Madrugada' : hour < 12 ? 'MaÃ±ana' : hour < 17 ? 'MediodÃ­a' : hour < 21 ? 'Tarde' : 'Noche';
    const slotEn = hour < 6 ? 'Night' : hour < 12 ? 'Morning' : hour < 17 ? 'Midday' : hour < 21 ? 'Afternoon' : 'Evening';
    T.es.diary.unshift({ slot: slotEs, time: realTime, note: noteVal || 'â€”', moodIdx: currentMoodIdx });
    T.en.diary.unshift({ slot: slotEn, time: realTime, note: noteVal || 'â€”', moodIdx: currentMoodIdx });
    // Rebuild diary immediately so the entry is visible when navigating to Lume
    rebuildDiary();
    // Update home
    const timeLabel = currentLang==='es' ? 'Ãšltimo registro Â· ' : 'Last entry Â· ';
    document.getElementById('home-mood-time').textContent = timeLabel + realTime;
    if(noteVal) document.getElementById('home-mood-note').textContent = `"${noteVal}"`;
    document.getElementById('home-mood-name').textContent = m.name;
    document.getElementById('home-mood-name').style.color = MOOD_COLORS[currentMoodIdx];
    setBulb(document.getElementById('home-bulb-inner'), document.getElementById('home-bulb-glow'), currentMoodIdx);
    document.getElementById('ci-note').value = '';
    document.getElementById('note-count').textContent = '0 / 120';
  }
  if(id === 'home') {
    const moods = getMoods();
    const m = moods[currentMoodIdx];
    document.getElementById('home-mood-name').textContent = m.name;
    document.getElementById('home-mood-name').style.color = MOOD_COLORS[currentMoodIdx];
    document.getElementById('stat-mood').textContent = moods[2].name;
    setBulb(document.getElementById('home-bulb-inner'), document.getElementById('home-bulb-glow'), currentMoodIdx);
    document.getElementById('home-bulb').style.boxShadow = `0 0 24px rgba(${MOOD_RGB[currentMoodIdx]},.55), 0 0 48px rgba(${MOOD_RGB[currentMoodIdx]},.25)`;
    applyTheme(currentMoodIdx);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEEK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rebuildWeek() {
  const strip = document.getElementById('week-strip');
  strip.innerHTML = '';
  const days = T[currentLang].week_days;
  WEEK.forEach(item => {
    const d = document.createElement('div'); d.className = 'wd';
    const dot = document.createElement('div');
    dot.className = 'wd-dot ' + (item.m >= 0 ? 'filled' : 'empty');
    if(item.m >= 0) {
      dot.style.background = `radial-gradient(circle at 38% 32%, rgba(255,255,255,.7), ${MOOD_COLORS[item.m]} 55%, rgba(0,0,0,.2))`;
      dot.style.boxShadow = `0 0 14px rgba(${MOOD_RGB[item.m]},.7), 0 0 28px rgba(${MOOD_RGB[item.m]},.35)`;
      const core = document.createElement('div');
      core.style.cssText = `position:absolute;inset:28%;border-radius:50%;background:rgba(255,255,255,.85);filter:blur(2px);`;
      dot.appendChild(core);
    }
    const lbl = document.createElement('div');
    lbl.className = 'wd-lbl'; lbl.textContent = days[item.d];
    d.appendChild(dot); d.appendChild(lbl);
    strip.appendChild(d);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIARY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rebuildDiary() {
  const tl = document.getElementById('timeline');
  // keep the tl-line, remove entries
  const line = tl.querySelector('.tl-line');
  tl.innerHTML = '';
  tl.appendChild(line);

  const diary = T[currentLang].diary;
  const moods = getMoods();
  diary.forEach((entry, i) => {
    const mIdx = entry.moodIdx !== undefined ? entry.moodIdx : 2;
    const m = moods[mIdx];
    const mc = MOOD_COLORS[mIdx]; const mr = MOOD_RGB[mIdx];
    const div = document.createElement('div');
    div.className = 'tl-entry'; div.style.animationDelay = (i * 0.12) + 's';
    div.innerHTML = `
      <div class="tl-dot-wrap">
        <div class="tl-dot" style="background:rgba(${mr},.2);border-color:rgba(${mr},.5);box-shadow:0 0 8px rgba(${mr},.4)">
          <div class="tl-dot-inner" style="background:${mc}"></div>
        </div>
      </div>
      <div class="gc tl-card">
        <div class="tl-card" style="background:rgba(${mr},.06)">
          <div class="tl-card-header">
            <div class="tl-bulb">
              <div style="position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 38% 32%,rgba(255,255,255,.5),${mc} 55%,rgba(0,0,0,.2))"></div>
              <div class="tl-bulb-core"></div>
              <div class="tl-bulb-glow" style="background:${mc}"></div>
            </div>
            <div class="tl-meta">
              <div class="tl-time">${entry.slot} Â· ${entry.time}</div>
              <div class="tl-mood-name" style="color:${mc}">${moods[mIdx].name}</div>
            </div>
          </div>
          <div class="tl-note">"${entry.note}"</div>
          <div class="tl-edit" onclick="openEditModal(${i}, '${entry.slot}', '${entry.time}', ${mIdx})"><span>âœ</span><span>${T[currentLang].tl_edit}</span></div>
        </div>
      </div>`;
    tl.appendChild(div);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALENDAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rebuildCalendar() {
  const header = document.getElementById('cal-header');
  const grid = document.getElementById('cal-grid');
  const legend = document.getElementById('cal-legend');
  const barsEl = document.getElementById('ms-bars');
  header.innerHTML = ''; grid.innerHTML = ''; legend.innerHTML = ''; barsEl.innerHTML = '';

  const moods = getMoods();
  const days = T[currentLang].cal_days;
  days.forEach(d => { const h = document.createElement('div'); h.className='cal-dh'; h.textContent=d; header.appendChild(h); });

  CAL_DATA.forEach((mIdx, i) => {
    const day = i + 1;
    const cell = document.createElement('div');
    const isToday = day === 23;
    if(mIdx >= 0) {
      cell.className = 'cal-cell has-mood' + (isToday?' today-cell':'');
      cell.style.background = `radial-gradient(circle at 38% 32%, rgba(255,255,255,.55), ${MOOD_COLORS[mIdx]} 55%, rgba(0,0,0,.2))`;
      cell.style.boxShadow = `0 0 10px rgba(${MOOD_RGB[mIdx]},.6), 0 0 20px rgba(${MOOD_RGB[mIdx]},.25)`;
      cell.innerHTML = `<div style="position:absolute;inset:28%;border-radius:50%;background:rgba(255,255,255,.8);filter:blur(2px);z-index:1;pointer-events:none"></div><span style="position:relative;z-index:2;font-size:10px">${day}</span><div class="cell-glow" style="background:${MOOD_COLORS[mIdx]}"></div>`;
    } else {
      cell.className = 'cal-cell no-mood' + (isToday?' today-cell':'');
      cell.textContent = day;
    }
    grid.appendChild(cell);
    if(mIdx >= 0) {
      cell.addEventListener('click', e => {
        const ripple = document.createElement('div'); ripple.className = 'cal-ripple'; cell.appendChild(ripple);
        ripple.addEventListener('animationend', () => { ripple.remove(); openDayDetail(day); });
      });
    }
  });

  moods.forEach((m, i) => {
    const li = document.createElement('div'); li.className = 'leg-item';
    li.innerHTML = `<div class="leg-dot" style="background:${MOOD_COLORS[i]};box-shadow:0 0 6px ${MOOD_COLORS[i]}"></div><span class="leg-name">${m.name}</span>`;
    legend.appendChild(li);
  });

  const max = Math.max(...STATS_DIST.map(s => s.count));
  STATS_DIST.forEach(s => {
    const m = moods[s.moodIdx];
    const row = document.createElement('div'); row.className = 'ms-bar-row';
    row.innerHTML = `<div class="ms-bar-label">${m.name}</div><div class="ms-bar-track"><div class="ms-bar-fill" style="width:${(s.count/max*100)}%;background:linear-gradient(90deg,rgba(${MOOD_RGB[s.moodIdx]},.5),${MOOD_COLORS[s.moodIdx]})"></div></div><div class="ms-bar-count">${s.count}</div>`;
    barsEl.appendChild(row);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERFIL IDENTITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rebuildIdentity() {
  const el = document.getElementById('identity-moods');
  el.innerHTML = '';
  const sorted = [...STATS_DIST].sort((a,b) => b.count-a.count).slice(0,3);
  const total = STATS_DIST.reduce((a,b) => a+b.count, 0);
  const moods = getMoods();
  sorted.forEach(s => {
    const pct = Math.round(s.count/total*100);
    const d = document.createElement('div'); d.className = 'id-mood';
    d.innerHTML = `
      <div class="id-bulb">
        <div style="position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 38% 32%,rgba(255,255,255,.5),${MOOD_COLORS[s.moodIdx]} 55%,rgba(0,0,0,.2))"></div>
        <div class="id-bulb-core"></div>
        <div class="id-bulb-glow" style="background:${MOOD_COLORS[s.moodIdx]}"></div>
      </div>
      <div class="id-pct" style="color:${MOOD_COLORS[s.moodIdx]}">${pct}%</div>
      <div class="id-name">${moods[s.moodIdx].name}</div>`;
    el.appendChild(d);
  });
  document.getElementById('pa-shell').style.background = `radial-gradient(circle at 38% 32%,rgba(255,255,255,.5),${MOOD_COLORS[currentMoodIdx]} 55%,rgba(0,0,0,.2))`;
  document.getElementById('pa-outer').style.background = MOOD_COLORS[currentMoodIdx];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHECK-IN ORB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPips() {
  const el = document.getElementById('pips');
  MOOD_COLORS.forEach((c, i) => {
    const p = document.createElement('div');
    p.className = 'pip' + (i === currentMoodIdx ? ' active' : '');
    p.style.background = c; p.style.color = c;
    p.onclick = () => setMood(i);
    el.appendChild(p);
  });
}

function setMood(idx) {
  currentMoodIdx = idx;
  const moods = getMoods();
  applyTheme(idx);

  const shell = document.getElementById('mo-shell');
  const outer = document.getElementById('mo-outer');
  const orb   = document.getElementById('main-orb');
  shell.style.background = `radial-gradient(circle at 38% 32%, rgba(255,255,255,.55), ${MOOD_COLORS[idx]} 55%, rgba(0,0,0,.25))`;
  outer.style.background = MOOD_COLORS[idx];
  orb.style.boxShadow = `0 0 55px rgba(${MOOD_RGB[idx]},.65), 0 0 110px rgba(${MOOD_RGB[idx]},.3), inset 0 -15px 35px rgba(0,0,0,.2)`;

  document.getElementById('ci-mood-name').textContent = moods[idx].name;
  document.getElementById('ci-mood-name').style.color  = MOOD_COLORS[idx];
  document.getElementById('ci-mood-desc').textContent  = moods[idx].desc;

  document.querySelectorAll('.pip').forEach((p,i) => p.classList.toggle('active', i===idx));
  ['r1','r2','r3'].forEach(id => { document.getElementById(id).style.borderColor = `rgba(${MOOD_RGB[idx]},.2)`; });

  document.getElementById('home-flame').style.background = `radial-gradient(circle at 40% 35%,rgba(255,255,255,.3),rgba(${MOOD_RGB[idx]},.7))`;
  document.getElementById('home-flame').style.boxShadow = `0 0 20px rgba(${MOOD_RGB[idx]},.5)`;
}

// â”€â”€ DRAG â”€â”€
let dragging = false, sx = 0, sy = 0;
const orbEl = document.getElementById('main-orb');
function getXY(e){ return e.touches ? {x:e.touches[0].clientX,y:e.touches[0].clientY} : {x:e.clientX,y:e.clientY}; }
orbEl.addEventListener('mousedown', e=>{dragging=true;const p=getXY(e);sx=p.x;sy=p.y;orbEl.classList.add('dragging')});
orbEl.addEventListener('touchstart',e=>{dragging=true;const p=getXY(e);sx=p.x;sy=p.y;orbEl.classList.add('dragging')},{passive:true});
document.addEventListener('mousemove', drag);
document.addEventListener('touchmove', drag, {passive:true});
function drag(e){
  if(!dragging) return;
  const p=getXY(e); const dx=p.x-sx; const dy=p.y-sy;
  const dist=Math.sqrt(dx*dx+dy*dy);
  if(dist>22){
    const angle=Math.atan2(dy,dx)*180/Math.PI;
    let idx=2;
    if(angle>-60&&angle<=60) idx=1;
    else if(angle>60&&angle<=120) idx=4;
    else if(angle>120||angle<=-120) idx=3;
    else idx=0;
    setMood(idx); sx=p.x; sy=p.y;
  }
  orbEl.style.transform=`translate(${dx*.08}px,${dy*.08}px) scale(${1+dist*.0004})`;
}
document.addEventListener('mouseup',()=>{dragging=false;orbEl.classList.remove('dragging');orbEl.style.transform='';});
document.addEventListener('touchend',()=>{dragging=false;orbEl.classList.remove('dragging');orbEl.style.transform='';});
orbEl.addEventListener('click',()=>setMood((currentMoodIdx+1)%5));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildParticles(){
  const c = document.getElementById('particles');
  for(let i=0; i<20; i++){
    const p = document.createElement('div'); p.className = 'pt';
    const sz = 1+Math.random()*2.5+'px';
    p.style.cssText = `width:${sz};height:${sz};left:${Math.random()*100}%;animation-duration:${10+Math.random()*18}s;animation-delay:${-Math.random()*25}s;opacity:${.25+Math.random()*.5}`;
    c.appendChild(p);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAY DETAIL OVERLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openDayDetail(day) {
  const t = T[currentLang];
  const moods = getMoods();
  const entries = t.day_detail;

  // Generate per-day mood entries using CAL_DATA as seed for variety
  // The dominant mood (CAL_DATA) should be the most frequent in the entries
  const dayMoodIdx = CAL_DATA[day - 1] >= 0 ? CAL_DATA[day - 1] : 2;
  // Build moodIdxes so the dominant mood appears at least twice (most frequent)
  const seed = day % 5;
  const altMood1 = (dayMoodIdx + 1 + seed) % 5;
  const altMood2 = (dayMoodIdx + 3 + seed) % 5;
  // Dominant mood appears in entries[0] and entries[2] â†’ most frequent = dayMoodIdx
  const moodIdxes = [dayMoodIdx, altMood1, dayMoodIdx, altMood2];

  // Dominant = most frequent among moodIdxes
  const freq = {};
  moodIdxes.forEach(m => freq[m] = (freq[m] || 0) + 1);
  const domIdx = parseInt(Object.keys(freq).reduce((a, b) => freq[a] > freq[b] ? a : b));
  const dom = moods[domIdx];
  document.getElementById('day-dom-shell').style.background = `radial-gradient(circle at 38% 32%, rgba(255,255,255,.55), ${MOOD_COLORS[domIdx]} 55%, rgba(0,0,0,.25))`;
  document.getElementById('day-dom-glow').style.background = MOOD_COLORS[domIdx];
  document.getElementById('day-dom-name').textContent = dom.name;
  document.getElementById('day-dom-name').style.color = MOOD_COLORS[domIdx];

  // Date display
  const dayNames = currentLang === 'es'
    ? ['Domingo','Lunes','Martes','MiÃ©rcoles','Jueves','Viernes','SÃ¡bado']
    : ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const weekDay = (0 + day - 1) % 7;
  document.getElementById('overlay-day-name').textContent = dayNames[weekDay];
  document.getElementById('overlay-date').textContent = currentLang === 'es'
    ? `${day} de febrero`
    : `February ${day}`;

  // Mode-aware styles
  const isDayMode = !isNightMode;
  const mc_dom = MOOD_COLORS[domIdx];
  const mr_dom = MOOD_RGB[domIdx];

  const overlayBg   = document.getElementById('day-overlay-bg');
  const overlayGrad = document.getElementById('day-overlay-grad');
  const overlayInner = document.getElementById('day-overlay-inner');
  const domCard     = document.getElementById('day-dominant');

  if (isDayMode) {
    overlayBg.style.background = `rgba(245,240,255,.96)`;
    overlayGrad.style.background = `radial-gradient(ellipse at 60% 0%, rgba(${mr_dom},.18) 0%, transparent 55%), radial-gradient(ellipse at 10% 90%, rgba(${mr_dom},.12) 0%, transparent 50%)`;
    overlayInner.style.color = '#1A1030';
    domCard.style.cssText = `margin:0 20px 14px;padding:11px 14px;border-radius:14px;display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.85);border:1px solid rgba(${mr_dom},.2);box-shadow:0 2px 12px rgba(${mr_dom},.1);`;
  } else {
    overlayBg.style.background = `rgba(6,4,15,.92)`;
    overlayGrad.style.background = `radial-gradient(ellipse at 60% 0%, rgba(${mr_dom},.12) 0%, transparent 55%)`;
    overlayInner.style.color = '#F0EBF8';
    domCard.style.cssText = `margin:0 20px 14px;padding:11px 14px;border-radius:14px;display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);`;
  }

  // Mood-aware copy banks (ES / EN) per mood index
  const MOOD_NOTES = {
    es: [
      // 0 Radiante
      [
        { slot:'MaÃ±ana',   time:'08:10', note:'Me despertÃ© con una sonrisa. Algo en el aire me decÃ­a que iba a ser un dÃ­a especial.' },
        { slot:'MediodÃ­a', time:'12:45', note:'Todo fluyendo. Las conversaciones, el trabajo, incluso el cafÃ© estaba perfecto.' },
        { slot:'Tarde',    time:'17:30', note:'Productividad mÃ¡xima. TerminÃ© todo y hasta me sobrÃ³ tiempo para pasear.' },
        { slot:'Noche',    time:'21:50', note:'QuÃ© dÃ­a tan completo. Me fui a la cama sintiÃ©ndome en paz y llena de gratitud.' },
      ],
      // 1 EnergÃ­a
      [
        { slot:'MaÃ±ana',   time:'07:50', note:'EmpecÃ© el dÃ­a disparada. Lista para conquistar todo lo que tenÃ­a pendiente.' },
        { slot:'MediodÃ­a', time:'12:30', note:'Sin parar desde las 8h. ReuniÃ³n, sprint, otra reuniÃ³n. Adrenalina a tope.' },
        { slot:'Tarde',    time:'17:45', note:'El cuerpo acusa el ritmo pero la mente sigue encendida. No quiero parar.' },
        { slot:'Noche',    time:'22:00', note:'Por fin parÃ©. Un baÃ±o caliente y a descansar. MaÃ±ana con mÃ¡s calma.' },
      ],
      // 2 Calma
      [
        { slot:'MaÃ±ana',   time:'08:30', note:'Me despertÃ© despacio. Sin prisa. El tÃ©, la ventana abierta, el silencio.' },
        { slot:'MediodÃ­a', time:'13:00', note:'Comida tranquila. EscuchÃ© mÃºsica suave y dejÃ© que el tiempo pasara sin forzar nada.' },
        { slot:'Tarde',    time:'18:00', note:'Una caminata corta. El cuerpo pide movimiento suave, sin exigirse demasiado.' },
        { slot:'Noche',    time:'21:30', note:'LeÃ­ un rato antes de dormir. Me sentÃ­ en casa conmigo misma.' },
      ],
      // 3 ReflexiÃ³n
      [
        { slot:'MaÃ±ana',   time:'08:00', note:'Me quedÃ© mirando el techo unos minutos. Hay algo que necesita ordenarse por dentro.' },
        { slot:'MediodÃ­a', time:'13:15', note:'ComÃ­ sola, con intenciÃ³n. PensÃ© mucho en cÃ³mo quiero que sea esta etapa.' },
        { slot:'Tarde',    time:'17:00', note:'EscribÃ­ en el cuaderno. Las palabras ayudan a ver lo que la mente no sabe nombrar.' },
        { slot:'Noche',    time:'22:30', note:'Noche de preguntas. No todas tienen respuesta, y eso tambiÃ©n estÃ¡ bien.' },
      ],
      // 4 Sombra
      [
        { slot:'MaÃ±ana',   time:'09:00', note:'Cuesta arrancar. El cuerpo pesa y la motivaciÃ³n no llega. Me permitÃ­ ir despacio.' },
        { slot:'MediodÃ­a', time:'13:30', note:'DÃ­a gris por dentro. Hice lo mÃ­nimo. A veces eso es suficiente.' },
        { slot:'Tarde',    time:'17:00', note:'Necesitaba estar sola. Sin ruido, sin exigencias. Solo existir un rato.' },
        { slot:'Noche',    time:'21:00', note:'Me fui a dormir pronto. MaÃ±ana puede ser diferente. Por hoy, descanso.' },
      ],
    ],
    en: [
      // 0 Radiant
      [
        { slot:'Morning',   time:'08:10', note:'Woke up smiling. Something in the air told me today was going to be something else.' },
        { slot:'Midday',    time:'12:45', note:'Everything flowing â€” conversations, work, even the coffee was perfect.' },
        { slot:'Afternoon', time:'17:30', note:'Peak productivity. Finished everything and still had time for a walk.' },
        { slot:'Evening',   time:'21:50', note:'What a full day. Went to bed feeling at peace and deeply grateful.' },
      ],
      // 1 Energy
      [
        { slot:'Morning',   time:'07:50', note:'Started the day fired up. Ready to tackle everything on my list.' },
        { slot:'Midday',    time:'12:30', note:'Non-stop since 8am. Meeting, sprint, another meeting. Adrenaline peaking.' },
        { slot:'Afternoon', time:'17:45', note:'Body feels the pace but the mind is still on fire. I don\'t want to stop.' },
        { slot:'Evening',   time:'22:00', note:'Finally stopped. A warm bath and off to rest. Tomorrow, more calmly.' },
      ],
      // 2 Calm
      [
        { slot:'Morning',   time:'08:30', note:'Woke up slowly. No rush. Tea, open window, quiet.' },
        { slot:'Midday',    time:'13:00', note:'A peaceful lunch. Soft music and letting time pass without forcing anything.' },
        { slot:'Afternoon', time:'18:00', note:'A short walk. The body asks for gentle movement, nothing too demanding.' },
        { slot:'Evening',   time:'21:30', note:'Read a bit before sleep. Felt at home with myself.' },
      ],
      // 3 Reflection
      [
        { slot:'Morning',   time:'08:00', note:'Lay staring at the ceiling for a while. Something inside needs sorting out.' },
        { slot:'Midday',    time:'13:15', note:'Ate alone, intentionally. Thought a lot about what I want this chapter to look like.' },
        { slot:'Afternoon', time:'17:00', note:'Wrote in my notebook. Words help see what the mind can\'t quite name.' },
        { slot:'Evening',   time:'22:30', note:'A night of questions. Not all of them have answers â€” and that\'s okay.' },
      ],
      // 4 Shadow
      [
        { slot:'Morning',   time:'09:00', note:'Hard to start. The body feels heavy and motivation just isn\'t there. I let myself go slow.' },
        { slot:'Midday',    time:'13:30', note:'Grey day inside. Did the minimum. Sometimes that\'s enough.' },
        { slot:'Afternoon', time:'17:00', note:'Needed to be alone. No noise, no demands. Just exist for a while.' },
        { slot:'Evening',   time:'21:00', note:'Went to bed early. Tomorrow can be different. For today â€” rest.' },
      ],
    ],
  };

  const el = document.getElementById('day-entries');
  el.innerHTML = '';
  entries.forEach((entry, i) => {
    const mIdx = moodIdxes[i];
    const mc = MOOD_COLORS[mIdx]; const mr = MOOD_RGB[mIdx];
    // Use mood-coherent copy for this entry's mood
    const noteBank = MOOD_NOTES[currentLang][mIdx];
    const noteEntry = noteBank[i] || noteBank[0];
    const div = document.createElement('div');
    div.style.cssText = `margin-bottom:10px;animation:fsu .5s ${i*.1}s ease both;`;

    const cardStyle = isDayMode
      ? `padding:14px 16px;border-radius:16px;position:relative;overflow:hidden;background:rgba(255,255,255,.92);border:1px solid rgba(${mr},.18);box-shadow:0 2px 16px rgba(${mr},.1),0 1px 4px rgba(0,0,0,.06);`
      : `padding:14px 16px;border-radius:16px;position:relative;overflow:hidden;background:rgba(255,255,255,.06);border:1px solid rgba(${mr},.2);`;
    const slotColor  = isDayMode ? `rgba(26,16,48,.45)` : `rgba(240,235,248,.5)`;
    const noteColor  = isDayMode ? `rgba(26,16,48,.65)` : `rgba(240,235,248,.75)`;
    const accentBg   = isDayMode ? `rgba(${mr},.07)` : `rgba(${mr},.06)`;

    div.innerHTML = `
      <div style="${cardStyle}">
        <div style="position:absolute;inset:0;border-radius:16px;background:${accentBg};"></div>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;position:relative;">
          <div style="width:26px;height:26px;border-radius:50%;flex-shrink:0;position:relative;">
            <div style="position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 38% 32%,rgba(255,255,255,.55),${mc} 55%,rgba(0,0,0,.2));"></div>
            <div style="position:absolute;inset:26%;border-radius:50%;background:rgba(255,255,255,.88);filter:blur(2px);"></div>
            <div style="position:absolute;inset:-20%;border-radius:50%;background:${mc};opacity:.35;filter:blur(8px);"></div>
          </div>
          <div>
            <div style="font-size:9px;color:${slotColor};letter-spacing:.08em;text-transform:uppercase;">${noteEntry.slot} Â· ${noteEntry.time}</div>
            <div style="font-family:'Cormorant Garamond',serif;font-size:17px;font-weight:300;color:${mc};line-height:1;">${moods[mIdx].name}</div>
          </div>
        </div>
        <div style="font-size:13px;color:${noteColor};font-style:italic;line-height:1.6;position:relative;">"${noteEntry.note}"</div>
      </div>`;
    el.appendChild(div);
  });

  const overlay = document.getElementById('day-overlay');
  overlay.style.opacity = '1';
  overlay.style.pointerEvents = 'all';
}

document.getElementById('day-overlay-close').addEventListener('click', () => {
  const overlay = document.getElementById('day-overlay');
  overlay.style.opacity = '0';
  overlay.style.pointerEvents = 'none';
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NIGHT MODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ TIME-BASED GREETING â”€â”€
function getTimeGreeting(t) {
  const h = new Date().getHours();
  if (h >= 5 && h < 13) return t.home_greeting_morning;
  if (h >= 13 && h < 21) return t.home_greeting_afternoon;
  return t.home_greeting_night;
}
function getTimeAvatarLabel(t) {
  const h = new Date().getHours();
  if (h >= 5 && h < 13) return t.home_avatar_morning;
  if (h >= 13 && h < 21) return t.home_avatar_day;
  return t.home_avatar_night;
}

function applyModeChange() {
  document.body.classList.toggle('day-mode', !isNightMode);
  const t = T[currentLang];
  const toggle = document.getElementById('night-toggle');
  if(toggle){ toggle.classList.toggle('on', isNightMode); toggle.classList.toggle('off', !isNightMode); }
  document.getElementById('night-mode-label').textContent = isNightMode ? t.s_night_on : t.s_night_off;
  document.getElementById('night-icon').textContent = isNightMode ? 'ğŸŒ™' : 'â˜€ï¸';
  document.getElementById('home-mode-btn').textContent = isNightMode ? 'ğŸŒ™' : 'â˜€ï¸';
  document.getElementById('home-greeting').textContent = getTimeGreeting(t);
  document.getElementById('home-avatar-label').textContent = getTimeAvatarLabel(t);
  const avatarIcon = document.querySelector('#home-avatar span:first-child');
  if(avatarIcon) avatarIcon.textContent = isNightMode ? 'â˜½' : 'âœ¦';
}
function toggleNightMode()        { isNightMode = !isNightMode; applyModeChange(); }
function toggleNightModeFromHome(){ isNightMode = !isNightMode; applyModeChange(); }

// â”€â”€ CUSTOM CURSOR (desktop only) â”€â”€
const cursor    = document.getElementById('cursor');
const cursorDot = document.getElementById('cursor-dot');
document.addEventListener('mousemove', e => {
  cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
  cursorDot.style.left = e.clientX + 'px'; cursorDot.style.top = e.clientY + 'px';
});
document.addEventListener('mousedown', () => cursor.classList.add('pressed'));
document.addEventListener('mouseup',   () => cursor.classList.remove('pressed'));
document.addEventListener('mouseleave',() => { cursor.style.opacity='0'; cursorDot.style.opacity='0'; });
document.addEventListener('mouseenter',() => { cursor.style.opacity='1'; cursorDot.style.opacity='1'; });

// â”€â”€ NOTE COUNTER â”€â”€
document.getElementById('ci-note').addEventListener('input', function() {
  const len = this.value.length;
  if(len > 120) this.value = this.value.slice(0,120);
  document.getElementById('note-count').textContent = Math.min(len,120) + ' / 120';
  // Update home mood note live
  const noteEl = document.getElementById('home-mood-note');
  if(this.value.trim()) {
    noteEl.textContent = '"' + this.value.trim() + '"';
  } else {
    noteEl.textContent = T[currentLang].home_mood_note;
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EDIT MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let editEntryIdx = -1;
let editSelectedMood = 0;

function openEditModal(entryIdx, slot, time, moodIdx) {
  editEntryIdx = entryIdx;
  editSelectedMood = moodIdx;
  const t = T[currentLang];
  const moods = getMoods();
  const entry = t.diary[entryIdx];

  document.getElementById('edit-modal-slot').textContent = slot;
  document.getElementById('edit-modal-time').textContent = time;
  document.getElementById('edit-note').value = entry ? entry.note : '';
  document.getElementById('edit-save-btn').textContent = t.confirm_btn || 'Save changes âœ¦';
  document.getElementById('edit-lbl-mood').textContent = currentLang === 'es' ? 'Estado de Ã¡nimo' : 'Mood';
  document.getElementById('edit-lbl-note').textContent = currentLang === 'es' ? 'Nota' : 'Note';

  // Build mood pips
  const pipsEl = document.getElementById('edit-mood-pips');
  pipsEl.innerHTML = '';
  moods.forEach((m, i) => {
    const pip = document.createElement('div');
    pip.style.cssText = `display:flex;flex-direction:column;align-items:center;gap:5px;flex:1;cursor:pointer;`;
    pip.innerHTML = `
      <div style="width:36px;height:36px;border-radius:50%;background:radial-gradient(circle at 38% 32%,rgba(255,255,255,.5),${MOOD_COLORS[i]} 55%,rgba(0,0,0,.2));border:2px solid ${i===editSelectedMood?'rgba(255,255,255,.5)':'transparent'};transition:all .2s;box-shadow:${i===editSelectedMood?`0 0 12px ${MOOD_COLORS[i]}`:'none'};"></div>
      <div style="font-size:9px;color:rgba(240,235,248,${i===editSelectedMood?'0.85':'0.35'});text-align:center;letter-spacing:.03em;">${m.name}</div>`;
    pip.onclick = () => { editSelectedMood = i; openEditModal(entryIdx, slot, time, i); };
    pipsEl.appendChild(pip);
  });

  const modal = document.getElementById('edit-modal');
  modal.style.opacity = '1';
  modal.style.pointerEvents = 'all';
}

function closeEditModal() {
  const modal = document.getElementById('edit-modal');
  modal.style.opacity = '0';
  modal.style.pointerEvents = 'none';
}

function saveEditModal() {
  const note = document.getElementById('edit-note').value.trim();
  // Persist both note and moodIdx in both languages
  ['es','en'].forEach(lang => {
    if(T[lang].diary[editEntryIdx]) {
      T[lang].diary[editEntryIdx].note = note;
      T[lang].diary[editEntryIdx].moodIdx = editSelectedMood;
    }
  });
  // If it's the most recent entry, update home display too
  if(editEntryIdx === 0) {
    if(note) document.getElementById('home-mood-note').textContent = `"${note}"`;
    document.getElementById('home-mood-name').textContent = getMoods()[editSelectedMood].name;
    document.getElementById('home-mood-name').style.color = MOOD_COLORS[editSelectedMood];
    setBulb(document.getElementById('home-bulb-inner'), document.getElementById('home-bulb-glow'), editSelectedMood);
  }
  rebuildDiary();
  closeEditModal();
}



// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIVE CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateClocks() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2, '0');
  const m = String(now.getMinutes()).padStart(2, '0');
  const timeStr = h + ':' + m;
  document.querySelectorAll('.sb-clock').forEach(el => el.textContent = timeStr);
}
updateClocks();
setInterval(updateClocks, 15000);

(function init(){
  buildParticles();
  buildPips();

  // Initial mood setup
  applyTheme(currentMoodIdx);

  // Check-in orb
  document.getElementById('mo-shell').style.background = `radial-gradient(circle at 38% 32%, rgba(255,255,255,.55), ${MOOD_COLORS[currentMoodIdx]} 55%, rgba(0,0,0,.25))`;
  document.getElementById('mo-outer').style.background = MOOD_COLORS[currentMoodIdx];
  document.getElementById('main-orb').style.boxShadow  = `0 0 55px rgba(${MOOD_RGB[currentMoodIdx]},.65), 0 0 110px rgba(${MOOD_RGB[currentMoodIdx]},.3)`;

  // Home bulb
  setBulb(document.getElementById('home-bulb-inner'), document.getElementById('home-bulb-glow'), currentMoodIdx);
  document.getElementById('home-bulb').style.boxShadow = `0 0 24px rgba(${MOOD_RGB[currentMoodIdx]},.55), 0 0 48px rgba(${MOOD_RGB[currentMoodIdx]},.25)`;

  // Perfil
  document.getElementById('pa-shell').style.background = `radial-gradient(circle at 38% 32%,rgba(255,255,255,.5),${MOOD_COLORS[currentMoodIdx]} 55%,rgba(0,0,0,.2))`;
  document.getElementById('pa-outer').style.background = MOOD_COLORS[currentMoodIdx];

  // Apply language (EN default)
  setLanguage(currentLang);

  // Apply night mode
  applyModeChange();
})();
</script>
</body>
</html>